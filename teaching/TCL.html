<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Démonstration interactive du TCL</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; }
    .row { display:flex; align-items:center; gap:12px; margin-bottom:10px; flex-wrap: wrap; }
    #plot { max-width: 900px; width: 100%; }
    input[type=range] { width: 240px; }
    small { color:#555; }
  </style>
</head>
<body>
  <h2>Théorème Central Limite — simulation interactive</h2>
  <div class="row">
    <label for="n">Taille de l’échantillon n :</label>
    <input id="n" type="range" min="1" max="100" value="1" step="1"/>
    <span id="nVal">1</span>
  </div>
  <div class="row">
    <label for="trials">Nombre d’itérations :</label>
    <input id="trials" type="range" min="500" max="20000" value="5000" step="500"/>
    <span id="tVal">5000</span>
  </div>
  <div class="row">
    <label for="dist">Loi de base :</label>
    <select id="dist">
      <option value="exp" selected>Exponentielle(1)</option>
      <option value="uniform">Uniforme(0,1)</option>
      <option value="bernoulli">Bernoulli(0,2)</option>
      <option value="student">Student t (ddl=3)</option>
    </select>
    <small>On trace Z = (X̄−μ) / (σ/√n). La courbe noire correspond à 𝓝(0,1).</small>
  </div>
  <div id="plot"></div>

<script>
function rand() { return Math.random(); }

function randExp() {
  // Inverse CDF: -ln(1-U), mean=1, sd=1
  return -Math.log(1-rand());
}

function randUniform() {
  return rand(); // mean=0.5, var=1/12, sd≈0.288675
}

function randBernoulli(p=0.2) {
  return +(rand() < p);
}

function randStudentT(df=3) {
  // Box-Muller for normal(0,1)
  function randn() {
    const u1 = Math.random();
    const u2 = Math.random();
    return Math.sqrt(-2*Math.log(u1)) * Math.cos(2*Math.PI*u2);
  }
  // Student t via Normal / sqrt(ChiSq/df)
  // Chi-square via sum of squares of N(0,1)
  let chi2 = 0;
  for (let i=0;i<df;i++){ const z = randn(); chi2 += z*z; }
  const z = randn();
  return z / Math.sqrt(chi2/df);
}

function drawBase(dist){
  if(dist === 'exp') {
    return { draw: randExp, mu: 1.0, sigma: 1.0 };
  } else if(dist === 'uniform') {
    return { draw: randUniform, mu: 0.5, sigma: Math.sqrt(1/12) };
  } else if(dist === 'bernoulli') {
    const p = 0.2;
    return { draw: () => randBernoulli(p), mu: p, sigma: Math.sqrt(p*(1-p)) };
  } else if(dist === 'student') {
    const df = 3;
    // Mean=0 for df>1, SD = sqrt(df/(df-2)) for df>2
    return { draw: () => randStudentT(df), mu: 0.0, sigma: Math.sqrt(df/(df-2)) };
  }
  return { draw: randExp, mu: 1.0, sigma: 1.0 };
}

function standardizedSampleMeans(n, trials, base){
  const out = new Array(trials);
  for(let t=0; t<trials; t++){
    let s = 0;
    for(let i=0; i<n; i++){ s += base.draw(); }
    const mean = s / n;
    const z = (mean - base.mu) / (base.sigma / Math.sqrt(n));
    out[t] = z;
  }
  return out;
}

const plotDiv = document.getElementById('plot');
const nSlider = document.getElementById('n');
const nVal = document.getElementById('nVal');
const tSlider = document.getElementById('trials');
const tVal = document.getElementById('tVal');
const distSel = document.getElementById('dist');

function normalPDF(x){
  return Math.exp(-0.5*x*x)/Math.sqrt(2*Math.PI);
}

const grid = Array.from({length: 400}, (_,i)=> -4.5 + 9*i/399);
const normY = grid.map(normalPDF);

function render(){
  const n = parseInt(nSlider.value,10);
  const trials = parseInt(tSlider.value,10);
  nVal.textContent = n;
  tVal.textContent = trials;
  const base = drawBase(distSel.value);
  const Z = standardizedSampleMeans(n, trials, base);
  const traceHist = {
    x: Z, type: 'histogram', histnorm: 'probability density', nbinsx: 60, name: 'Standardized sample mean'
  };
  const traceN = { x: grid, y: normY, type: 'scatter', mode: 'lines', name: '𝓝(0,1)' };
  const layout = {
    title: 'Théorème Centrale Limite : Z = (X̄−μ) / (σ/√n)',
    xaxis: { range: [-4.5, 4.5], title: 'Z' },
    yaxis: { range: [0, 0.6], title: 'Densité' },
    bargap: 0.02,
    showlegend: false
  };
  Plotly.newPlot(plotDiv, [traceHist, traceN], layout, {responsive:true});
}

nSlider.oninput = render;
tSlider.oninput = render;
distSel.onchange = render;
render();
</script>
</body>
</html>
